{"ast":null,"code":"// client.js\nimport axios from 'axios';\n\n// Base URL của Django API\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8080';\n\n// Tạo axios instance\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  timeout: 10000 // 10 seconds timeout\n});\n\n// Request interceptor - thêm token vào header\napiClient.interceptors.request.use(config => {\n  const token = localStorage.getItem('access_token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Response interceptor - xử lý lỗi và refresh token\napiClient.interceptors.response.use(response => {\n  return response;\n}, async error => {\n  var _error$response;\n  const originalRequest = error.config;\n\n  // Nếu token hết hạn (401) và chưa retry\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    try {\n      const refreshToken = localStorage.getItem('refresh_token');\n      if (refreshToken) {\n        // Sử dụng endpoint refresh token của Django SimpleJWT\n        const response = await axios.post(`${API_BASE_URL}/api/token/refresh/`, {\n          refresh: refreshToken\n        });\n        const newAccessToken = response.data.access;\n        localStorage.setItem('access_token', newAccessToken);\n\n        // Retry request với token mới\n        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n        return apiClient(originalRequest);\n      }\n    } catch (refreshError) {\n      // Refresh token cũng hết hạn, đăng xuất user\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n      localStorage.removeItem('user'); // Xóa thông tin user\n      window.location.href = '/login';\n      return Promise.reject(refreshError);\n    }\n  }\n  return Promise.reject(error);\n});\nexport default apiClient;\n\n// Export thêm các helper functions\nexport const saveTokens = tokens => {\n  if (tokens.access) {\n    localStorage.setItem('access_token', tokens.access);\n  }\n  if (tokens.refresh) {\n    localStorage.setItem('refresh_token', tokens.refresh);\n  }\n};\nexport const clearTokens = () => {\n  localStorage.removeItem('access_token');\n  localStorage.removeItem('refresh_token');\n  localStorage.removeItem('user');\n};\nexport const getAccessToken = () => {\n  return localStorage.getItem('access_token');\n};\nexport const isAuthenticated = () => {\n  return !!getAccessToken();\n};","map":{"version":3,"names":["axios","API_BASE_URL","process","env","REACT_APP_API_URL","apiClient","create","baseURL","headers","timeout","interceptors","request","use","config","token","localStorage","getItem","Authorization","error","Promise","reject","response","_error$response","originalRequest","status","_retry","refreshToken","post","refresh","newAccessToken","data","access","setItem","refreshError","removeItem","window","location","href","saveTokens","tokens","clearTokens","getAccessToken","isAuthenticated"],"sources":["D:/BaitapUIT/Mat_Ma_Hoc/new_final_project_clone/quantum-e-commerce/FE/src/api/client.js"],"sourcesContent":["// client.js\r\nimport axios from 'axios';\r\n\r\n// Base URL của Django API\r\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8080';\r\n\r\n// Tạo axios instance\r\nconst apiClient = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n  timeout: 10000, // 10 seconds timeout\r\n});\r\n\r\n// Request interceptor - thêm token vào header\r\napiClient.interceptors.request.use(\r\n  (config) => {\r\n    const token = localStorage.getItem('access_token');\r\n    if (token) {\r\n      config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// Response interceptor - xử lý lỗi và refresh token\r\napiClient.interceptors.response.use(\r\n  (response) => {\r\n    return response;\r\n  },\r\n  async (error) => {\r\n    const originalRequest = error.config;\r\n\r\n    // Nếu token hết hạn (401) và chưa retry\r\n    if (error.response?.status === 401 && !originalRequest._retry) {\r\n      originalRequest._retry = true;\r\n\r\n      try {\r\n        const refreshToken = localStorage.getItem('refresh_token');\r\n        if (refreshToken) {\r\n          // Sử dụng endpoint refresh token của Django SimpleJWT\r\n          const response = await axios.post(`${API_BASE_URL}/api/token/refresh/`, {\r\n            refresh: refreshToken\r\n          });\r\n          \r\n          const newAccessToken = response.data.access;\r\n          localStorage.setItem('access_token', newAccessToken);\r\n          \r\n          // Retry request với token mới\r\n          originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\r\n          return apiClient(originalRequest);\r\n        }\r\n      } catch (refreshError) {\r\n        // Refresh token cũng hết hạn, đăng xuất user\r\n        localStorage.removeItem('access_token');\r\n        localStorage.removeItem('refresh_token');\r\n        localStorage.removeItem('user'); // Xóa thông tin user\r\n        window.location.href = '/login';\r\n        return Promise.reject(refreshError);\r\n      }\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default apiClient;\r\n\r\n// Export thêm các helper functions\r\nexport const saveTokens = (tokens) => {\r\n  if (tokens.access) {\r\n    localStorage.setItem('access_token', tokens.access);\r\n  }\r\n  if (tokens.refresh) {\r\n    localStorage.setItem('refresh_token', tokens.refresh);\r\n  }\r\n};\r\n\r\nexport const clearTokens = () => {\r\n  localStorage.removeItem('access_token');\r\n  localStorage.removeItem('refresh_token');\r\n  localStorage.removeItem('user');\r\n};\r\n\r\nexport const getAccessToken = () => {\r\n  return localStorage.getItem('access_token');\r\n};\r\n\r\nexport const isAuthenticated = () => {\r\n  return !!getAccessToken();\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}