<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè H√†ng - ShopSecure</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(90deg, #ee4d2d, #f05123);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }

        .logo::before {
            content: 'üõ°Ô∏è';
            margin-right: 0.5rem;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Security Banner */
        .security-banner {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .security-banner h2 {
            margin-bottom: 0.5rem;
        }

        /* Cart Container */
        .cart-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        /* Cart Items */
        .cart-items {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }

        .cart-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .select-all {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .select-all input[type="checkbox"] {
            transform: scale(1.2);
        }

        /* Cart Item */
        .cart-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto auto;
            gap: 1rem;
            align-items: center;
            padding: 1.5rem 0;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .cart-item:hover {
            background: #f8f9fa;
        }

        .item-checkbox {
            transform: scale(1.2);
        }

        .item-info {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .item-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #f0f2f5, #e4e6ea);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .item-details h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .item-variant {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .item-security {
            background: #e8f5e8;
            color: #28a745;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.8rem;
            display: inline-block;
        }

        .item-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ee4d2d;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #f5f5f5;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .quantity-btn:hover {
            background: #ee4d2d;
            color: white;
        }

        .quantity-input {
            width: 50px;
            height: 32px;
            border: none;
            text-align: center;
            outline: none;
        }

        .item-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .action-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 3px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background: #f0f0f0;
        }

        .delete-btn:hover {
            color: #e74c3c;
        }

        /* Empty Cart */
        .empty-cart {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-cart-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-cart h3 {
            margin-bottom: 1rem;
            color: #333;
        }

        .shop-now-btn {
            background: #ee4d2d;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-block;
            margin-top: 1rem;
        }

        .shop-now-btn:hover {
            background: #d63031;
        }

        /* Cart Summary */
        .cart-summary {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .summary-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #333;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            color: #666;
        }

        .summary-row.total {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            padding-top: 1rem;
            border-top: 2px solid #eee;
        }

        .total-price {
            color: #ee4d2d;
        }

        /* Security Features */
        .security-features {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin: 1.5rem 0;
        }

        .security-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #28a745;
        }

        .security-item:last-child {
            margin-bottom: 0;
        }

        /* Checkout Button */
        .checkout-btn {
            width: 100%;
            background: linear-gradient(90deg, #ee4d2d, #f05123);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1rem;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(238, 77, 45, 0.3);
        }

        .checkout-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Voucher Section */
        .voucher-section {
            margin: 1.5rem 0;
            padding: 1rem;
            border: 2px dashed #ddd;
            border-radius: 10px;
        }

        .voucher-input {
            display: flex;
            gap: 0.5rem;
        }

        .voucher-input input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            outline: none;
        }

        .voucher-input input:focus {
            border-color: #ee4d2d;
        }

        .apply-btn {
            background: #ee4d2d;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .apply-btn:hover {
            background: #d63031;
        }

        /* Shipping Options */
        .shipping-options {
            margin: 1.5rem 0;
        }

        .shipping-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shipping-option:hover {
            border-color: #ee4d2d;
            background: #fff5f5;
        }

        .shipping-option input[type="radio"] {
            transform: scale(1.2);
        }

        .shipping-info {
            flex: 1;
        }

        .shipping-name {
            font-weight: bold;
            color: #333;
        }

        .shipping-time {
            font-size: 0.9rem;
            color: #666;
        }

        .shipping-price {
            font-weight: bold;
            color: #ee4d2d;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cart-container {
                grid-template-columns: 1fr;
            }

            .cart-item {
                grid-template-columns: auto 1fr;
                gap: 1rem;
            }

            .item-info {
                flex-direction: column;
                align-items: flex-start;
            }

            .quantity-controls,
            .item-actions {
                margin-top: 0.5rem;
            }

            .cart-summary {
                position: static;
            }
        }

        /* Loading Animation */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .loading-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ee4d2d;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(-100%); }
        }

        .slide-out {
            animation: slideOut 0.3s ease-in;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">ShopSecure</a>
            <nav class="nav-links">
                <a href="index.html" class="nav-link">üè† Trang ch·ªß</a>
                <a href="#" class="nav-link">üì± S·∫£n ph·∫©m</a>
                <a href="#" class="nav-link">üë§ T√†i kho·∫£n</a>
            </nav>
        </div>
    </header>

    <!-- Main Container -->
    <main class="main-container">
        <!-- Security Banner -->
        <div class="security-banner fade-in">
            <h2>üõ°Ô∏è Gi·ªè H√†ng ƒê∆∞·ª£c B·∫£o M·∫≠t</h2>
            <p>M·ªçi s·∫£n ph·∫©m trong gi·ªè h√†ng ƒë·ªÅu ƒë∆∞·ª£c m√£ h√≥a v√† x√°c th·ª±c b·∫±ng ch·ªØ k√Ω s·ªë</p>
        </div>

        <!-- Cart Container -->
        <div class="cart-container">
            <!-- Cart Items -->
            <div class="cart-items fade-in">
                <div class="cart-header">
                    <h2 class="cart-title">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>
                    <label class="select-all">
                        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                        <span>Ch·ªçn t·∫•t c·∫£</span>
                    </label>
                </div>

                <div id="cartItemsList">
                    <!-- Cart items will be loaded here -->
                </div>

                <!-- Empty Cart State -->
                <div id="emptyCart" class="empty-cart" style="display: none;">
                    <div class="empty-cart-icon">üõí</div>
                    <h3>Gi·ªè h√†ng tr·ªëng</h3>
                    <p>H√£y th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng ƒë·ªÉ ti·∫øp t·ª•c mua s·∫Øm</p>
                    <a href="index.html" class="shop-now-btn">Mua s·∫Øm ngay</a>
                </div>
            </div>

            <!-- Cart Summary -->
            <div class="cart-summary fade-in">
                <h3 class="summary-title">üìã T√≥m t·∫Øt ƒë∆°n h√†ng</h3>

                <!-- Voucher Section -->
                <div class="voucher-section">
                    <h4 style="margin-bottom: 0.5rem;">üé´ M√£ gi·∫£m gi√°</h4>
                    <div class="voucher-input">
                        <input type="text" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°" id="voucherCode">
                        <button class="apply-btn" onclick="applyVoucher()">√Åp d·ª•ng</button>
                    </div>
                </div>

                <!-- Shipping Options -->
                <div class="shipping-options">
                    <h4 style="margin-bottom: 0.5rem;">üöö Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn</h4>
                    <label class="shipping-option">
                        <input type="radio" name="shipping" value="standard" checked onchange="updateShipping()">
                        <div class="shipping-info">
                            <div class="shipping-name">Giao h√†ng ti√™u chu·∫©n</div>
                            <div class="shipping-time">3-5 ng√†y l√†m vi·ªác</div>
                        </div>
                        <div class="shipping-price">Mi·ªÖn ph√≠</div>
                    </label>
                    <label class="shipping-option">
                        <input type="radio" name="shipping" value="express" onchange="updateShipping()">
                        <div class="shipping-info">
                            <div class="shipping-name">Giao h√†ng nhanh</div>
                            <div class="shipping-time">1-2 ng√†y l√†m vi·ªác</div>
                        </div>
                        <div class="shipping-price">30.000‚Ç´</div>
                    </label>
                    <label class="shipping-option">
                        <input type="radio" name="shipping" value="instant" onchange="updateShipping()">
                        <div class="shipping-info">
                            <div class="shipping-name">Giao h√†ng trong ng√†y</div>
                            <div class="shipping-time">2-4 gi·ªù</div>
                        </div>
                        <div class="shipping-price">50.000‚Ç´</div>
                    </label>
                </div>

                <!-- Security Features -->
                <div class="security-features">
                    <div class="security-item">
                        <span>üîê</span>
                        <span>Ch·ªØ k√Ω s·ªë Crystal-Dilithium</span>
                    </div>
                    <div class="security-item">
                        <span>üîí</span>
                        <span>M√£ h√≥a AES-256</span>
                    </div>
                    <div class="security-item">
                        <span>üõ°Ô∏è</span>
                        <span>X√°c th·ª±c ECC + TLS</span>
                    </div>
                    <div class="security-item">
                        <span>üßÆ</span>
                        <span>BƒÉm SHA3 to√†n v·∫πn</span>
                    </div>
                </div>

                <!-- Summary Details -->
                <div class="summary-row">
                    <span>T·∫°m t√≠nh (<span id="itemCount">0</span> s·∫£n ph·∫©m):</span>
                    <span id="subtotal">0‚Ç´</span>
                </div>
                <div class="summary-row">
                    <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                    <span id="shippingFee">Mi·ªÖn ph√≠</span>
                </div>
                <div class="summary-row" id="discountRow" style="display: none;">
                    <span>Gi·∫£m gi√°:</span>
                    <span id="discountAmount" style="color: #28a745;">-0‚Ç´</span>
                </div>
                <div class="summary-row total">
                    <span>T·ªïng c·ªông:</span>
                    <span class="total-price" id="totalAmount">0‚Ç´</span>
                </div>

                <button class="checkout-btn" id="checkoutBtn" onclick="proceedToCheckout()" disabled>
                    üîí Thanh to√°n an to√†n
                </button>
            </div>
        </div>
    </main>

    <!-- Loading Modal -->
    <div class="loading" id="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>üõ°Ô∏è ƒêang x·ª≠ l√Ω an to√†n...</h3>
            <p>Vui l√≤ng ch·ªù trong gi√¢y l√°t</p>
        </div>
    </div>

    <script>
        // Security Manager
        class CartSecurityManager {
            constructor() {
                this.encryptionKey = 'cart-secure-key-2024';
            }

            sha3Hash(data) {
                return CryptoJS.SHA3(data, { outputLength: 256 }).toString();
            }

            aesEncrypt(data, key) {
                return CryptoJS.AES.encrypt(data, key).toString();
            }

            aesDecrypt(encryptedData, key) {
                const bytes = CryptoJS.AES.decrypt(encryptedData, key);
                return bytes.toString(CryptoJS.enc.Utf8);
            }

            createDigitalSignature(data) {
                const hash = this.sha3Hash(data);
                return btoa(hash + '-dilithium-cart-signature');
            }

            verifySignature(data, signature) {
                const hash = this.sha3Hash(data);
                const expectedSignature = btoa(hash + '-dilithium-cart-signature');
                return signature === expectedSignature;
            }
        }

        // Initialize security manager
        const cartSecurity = new CartSecurityManager();

        // Cart data
        let cartItems = [
            {
                id: 1,
                name: "iPhone 15 Pro Max",
                variant: "256GB, Titan T·ª± Nhi√™n",
                price: 29990000,
                originalPrice: 34990000,
                quantity: 1,
                image: "üì±",
                selected: true,
                signature: null,
                encrypted: true
            },
            {
                id: 2,
                name: "AirPods Pro 2",
                variant: "Tr·∫Øng",
                price: 6990000,
                originalPrice: 7990000,
                quantity: 2,
                image: "üéß",
                selected: true,
                signature: null,
                encrypted: true
            }
        ];

        let shippingFee = 0;
        let discountAmount = 0;
        let appliedVoucher = null;

        // Initialize cart
        function initializeCart() {
            // Create signatures for existing items
            cartItems.forEach(item => {
                const itemData = JSON.stringify({
                    id: item.id,
                    name: item.name,
                    quantity: item.quantity,
                    timestamp: new Date().toISOString()
                });
                item.signature = cartSecurity.createDigitalSignature(itemData);
            });

            renderCartItems();
            updateSummary();
        }

        // Render cart items
        function renderCartItems() {
            const cartList = document.getElementById('cartItemsList');
            const emptyCart = document.getElementById('emptyCart');

            if (cartItems.length === 0) {
                cartList.style.display = 'none';
                emptyCart.style.display = 'block';
                return;
            }

            cartList.style.display = 'block';
            emptyCart.style.display = 'none';

            cartList.innerHTML = cartItems.map((item, index) => `
                <div class="cart-item" data-index="${index}">
                    <input type="checkbox" class="item-checkbox" ${item.selected ? 'checked' : ''} 
                           onchange="toggleItemSelection(${index})">
                    
                    <div class="item-info">
                        <div class="item-image">${item.image}</div>
                        <div class="item-details">
                            <h3>${item.name}</h3>
                            <div class="item-variant">${item.variant}</div>
                            <div class="item-security">üõ°Ô∏è ƒê∆∞·ª£c b·∫£o m·∫≠t</div>
                        </div>
                    </div>
                    
                    <div class="item-price">
                        ${item.price.toLocaleString('vi-VN')}‚Ç´
                        ${item.originalPrice > item.price ? 
                            `<div style="font-size: 0.9rem; color: #999; text-decoration: line-through;">
                                ${item.originalPrice.toLocaleString('vi-VN')}‚Ç´
                            </div>` : ''
                        }
                    </div>
                    
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">‚àí</button>
                        <input type="number" class="quantity-input" value="${item.quantity}" 
                               min="1" max="10" onchange="setQuantity(${index}, this.value)">
                        <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
                    </div>
                    
                    <div class="item-actions">
                        <button class="action-btn" onclick="saveForLater(${index})">üíæ L∆∞u</button>
                        <button class="action-btn delete-btn" onclick="removeItem(${index})">üóëÔ∏è X√≥a</button>
                    </div>
                </div>
            `).join('');
        }

        // Toggle item selection
        function toggleItemSelection(index) {
            cartItems[index].selected = !cartItems[index].selected;
            updateSummary();
            updateSelectAllCheckbox();
        }

        // Toggle select all
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll').checked;
            cartItems.forEach(item => item.selected = selectAll);
            
            document.querySelectorAll('.item-checkbox').forEach(checkbox => {
                checkbox.checked = selectAll;
            });
            
            updateSummary();
        }

        // Update select all checkbox
        function updateSelectAllCheckbox() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const selectedItems = cartItems.filter(item => item.selected).length;
            
            selectAllCheckbox.checked = selectedItems === cartItems.length;
            selectAllCheckbox.indeterminate = selectedItems > 0 && selectedItems < cartItems.length;
        }

        // Update quantity
        function updateQuantity(index, change) {
            const newQuantity = cartItems[index].quantity + change;
            if (newQuantity >= 1 && newQuantity <= 10) {
                cartItems[index].quantity = newQuantity;
                
                // Create new signature for updated item
                const itemData = JSON.stringify({
                    id: cartItems[index].id,
                    quantity: newQuantity,
                    timestamp: new Date().toISOString()
                });
                cartItems[index].signature = cartSecurity.createDigitalSignature(itemData);
                
                renderCartItems();
                updateSummary();
                showNotification('‚úÖ C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng th√†nh c√¥ng!', 'success');
            }
        }

        // Set quantity directly
        function setQuantity(index, value) {
            const quantity = parseInt(value);
            if (quantity >= 1 && quantity <= 10) {
                cartItems[index].quantity = quantity;
                
                // Create new signature
                const itemData = JSON.stringify({
                    id: cartItems[index].id,
                    quantity: quantity,
                    timestamp: new Date().toISOString()
                });
                cartItems[index].signature = cartSecurity.createDigitalSignature(itemData);
                
                updateSummary();
            }
        }

        // Remove item
        function removeItem(index) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh·ªèi gi·ªè h√†ng?')) {
                const item = cartItems[index];
                
                // Add slide-out animation
                const itemElement = document.querySelector(`[data-index="${index}"]`);
                itemElement.classList.add('slide-out');
                
                setTimeout(() => {
                    cartItems.splice(index, 1);
                    renderCartItems();
                    updateSummary();
                    updateSelectAllCheckbox();
                    showNotification(`üóëÔ∏è ƒê√£ x√≥a ${item.name} kh·ªèi gi·ªè h√†ng`, 'info');
                }, 300);
            }
        }

        // Save for later
        function saveForLater(index) {
            const item = cartItems[index];
            showNotification(`üíæ ƒê√£ l∆∞u ${item.name} ƒë·ªÉ mua sau`, 'info');
            removeItem(index);
        }

        // Update shipping
        function updateShipping() {
            const selectedShipping = document.querySelector('input[name="shipping"]:checked').value;
            
            switch (selectedShipping) {
                case 'standard':
                    shippingFee = 0;
                    break;
                case 'express':
                    shippingFee = 30000;
                    break;
                case 'instant':
                    shippingFee = 50000;
                    break;
            }
            
            updateSummary();
        }

        // Apply voucher
        function applyVoucher() {
            const voucherCode = document.getElementById('voucherCode').value.trim().toUpperCase();
            
            if (!voucherCode) {
                showNotification('‚ùå Vui l√≤ng nh·∫≠p m√£ gi·∫£m gi√°!', 'error');
                return;
            }

            showLoading(true);

            // Simulate voucher validation with security
            const voucherData = JSON.stringify({
                code: voucherCode,
                timestamp: new Date().toISOString(),
                userId: 'user123'
            });
            const signature = cartSecurity.createDigitalSignature(voucherData);

            setTimeout(() => {
                showLoading(false);
                
                // Mock voucher codes
                const validVouchers = {
                    'SAVE10': { discount: 0.1, type: 'percentage', name: 'Gi·∫£m 10%' },
                    'SAVE50K': { discount: 50000, type: 'amount', name: 'Gi·∫£m 50.000‚Ç´' },
                    'FREESHIP': { discount: shippingFee, type: 'shipping', name: 'Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn' }
                };

                if (validVouchers[voucherCode]) {
                    appliedVoucher = validVouchers[voucherCode];
                    calculateDiscount();
                    updateSummary();
                    showNotification(`üé´ √Åp d·ª•ng m√£ gi·∫£m gi√° "${appliedVoucher.name}" th√†nh c√¥ng!`, 'success');
                } else {
                    showNotification('‚ùå M√£ gi·∫£m gi√° kh√¥ng h·ª£p l·ªá!', 'error');
                }
            }, 1500);
        }

        // Calculate discount
        function calculateDiscount() {
            const selectedItems = cartItems.filter(item => item.selected);
            const subtotal = selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            if (!appliedVoucher) {
                discountAmount = 0;
                return;
            }

            switch (appliedVoucher.type) {
                case 'percentage':
                    discountAmount = subtotal * appliedVoucher.discount;
                    break;
                case 'amount':
                    discountAmount = Math.min(appliedVoucher.discount, subtotal);
                    break;
                case 'shipping':
                    discountAmount = appliedVoucher.discount;
                    break;
            }
        }

        // Update summary
        function updateSummary() {
            const selectedItems = cartItems.filter(item => item.selected);
            const itemCount = selectedItems.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            calculateDiscount();
            const total = subtotal + shippingFee - discountAmount;

            document.getElementById('itemCount').textContent = itemCount;
            document.getElementById('subtotal').textContent = subtotal.toLocaleString('vi-VN') + '‚Ç´';
            document.getElementById('shippingFee').textContent = shippingFee === 0 ? 'Mi·ªÖn ph√≠' : shippingFee.toLocaleString('vi-VN') + '‚Ç´';
            document.getElementById('totalAmount').textContent = total.toLocaleString('vi-VN') + '‚Ç´';

            // Show/hide discount row
            const discountRow = document.getElementById('discountRow');
            if (discountAmount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('discountAmount').textContent = '-' + discountAmount.toLocaleString('vi-VN') + '‚Ç´';
            } else {
                discountRow.style.display = 'none';
            }

            // Enable/disable checkout button
            const checkoutBtn = document.getElementById('checkoutBtn');
            checkoutBtn.disabled = selectedItems.length === 0;
        }

        // Proceed to checkout
        function proceedToCheckout() {
            const selectedItems = cartItems.filter(item => item.selected);
            
            if (selectedItems.length === 0) {
                showNotification('‚ùå Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m!', 'error');
                return;
            }

            showLoading(true);

            // Create secure checkout data
            const checkoutData = {
                items: selectedItems,
                shipping: document.querySelector('input[name="shipping"]:checked').value,
                voucher: appliedVoucher,
                total: calculateTotal(),
                timestamp: new Date().toISOString(),
                userId: 'user123'
            };

            const checkoutDataString = JSON.stringify(checkoutData);
            const signature = cartSecurity.createDigitalSignature(checkoutDataString);
            const encryptedData = cartSecurity.aesEncrypt(checkoutDataString, cartSecurity.encryptionKey);

            // Simulate secure checkout process
            setTimeout(() => {
                showLoading(false);
                showNotification('üõ°Ô∏è Chuy·ªÉn ƒë·∫øn trang thanh to√°n an to√†n...', 'info');
                
                // Store encrypted checkout data for next page
                sessionStorage.setItem('secureCheckoutData', encryptedData);
                sessionStorage.setItem('checkoutSignature', signature);
                
                // Redirect to checkout page
                setTimeout(() => {
                    window.location.href = 'checkout.html';
                }, 1000);
            }, 2000);
        }

        // Calculate total
        function calculateTotal() {
            const selectedItems = cartItems.filter(item => item.selected);
            const subtotal = selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            return subtotal + shippingFee - discountAmount;
        }

        // Show loading
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#00b894' : type === 'error' ? '#e74c3c' : '#3498db'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                max-width: 300px;
                font-weight: bold;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Add notification animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeCart();
            
            // Add fade-in animation delay
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((element, index) => {
                element.style.animationDelay = `${index * 0.2}s`;
            });
            
            // Welcome message
            setTimeout(() => {
                showNotification('üõ°Ô∏è Gi·ªè h√†ng ƒë∆∞·ª£c b·∫£o m·∫≠t v·ªõi c√¥ng ngh·ªá ti√™n ti·∫øn!', 'info');
            }, 1000);
        });

        // Export for other pages
        window.CartSecure = {
            cartSecurity,
            cartItems,
            updateSummary,
            showNotification
        };
    </script>
</body>
</html>